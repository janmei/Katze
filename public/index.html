<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<link rel="shortcut icon" href="/favicon.ico">
	<title>Interactive Future 2018</title>

	<!-- p5 -->
	<script language="javascript" type="text/javascript" src="p5.min.js"></script>
	<script language="javascript" src="p5.dom.min.js"></script>
	<!-- ANIMATIONS -->
	<script language="javascript" src="animation_polys.js"></script>
	<script language="javascript" src="animation_title.js"></script>
	<script language="javascript" src="animation_program.js"></script>
	<script language="javascript" src="animation_countdown.js"></script>
	<script language="javascript" src="animation_main.js"></script>
	<!-- css -->
	<link rel="stylesheet" href="style.css" />
</head>

<body id="body">
	<div id="sketchContainer">
		<section class="main_wrapper">
			<!-- <h1 class="text">Hello World Public</h1> -->
			<div class="textContainer">
				<h1 class="headline" id="head">
					<b>interactive</b> <br />
					future exhibition
				</h1>
				<p class="text" id="sub"></p>
			</div>

			<!-- Nur fÃ¼r die letzten 10 Sekunden notwendig -->
			<!-- <div class="count10Container">
      <h1 class="headline" id="count10">10</h1>
    </div> -->

			<div class="countdownContainer">
				<div id="minutes"></div>
				<div id="seconds"></div>
			</div>

			<div class="table-content">
				<table class="table table-striped">
					<thead>
						<tr>
							<th scope="col">Semester</th>
							<th scope="col">Gruppe</th>
							<th scope="col">Team</th>
						</tr>
					</thead>
					<tbody id="timeBody"></tbody>
				</table>
			</div>

			<div class="sponsors" id="sponsors">
				<img src="../img/merck.png" alt="" class="sponsor-img active" />
				<img src="../img/honda.png" alt="" class="sponsor-img " />
				<img src="../img/stihl.png" alt="" class="sponsor-img " />
			</div>
		</section>

	</div>

	<script src="socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
	<script src="slide.js"></script>
	<script>
		var time;
		var slideIndex;

		var seks;
		var minuten;
		var room;

		function getQueryVariable(variable) {
			var query = window.location.search.substring(1);
			var vars = query.split("&");
			for (var i = 0; i < vars.length; i++) {
				var pair = vars[i].split("=");
				if (pair[0] == variable) {
					return pair[1];
				}
			}
			return (false);
		}

		$(function () {
			var frame = getQueryVariable('frame');
			var pathArray = window.location.pathname.split('/');
			room = pathArray[1]

			var socket = io('http://localhost:8000', {
				// path: '/browser-sync/socket.io',
				reconnection: false,
				query: 'frame=' + frame + '&room=' + room,
			});


			socket.on('connect', function () {
				console.log(room);

				$('#head').attr('data-name', room)
				$('#sub').attr('data-name', room)

				socket.emit('ROOM -> SERVER get data', room)
			})

			// Reconnects on disconnection
			socket.on('disconnect', function () {
				socket.connect();
			});

			socket.on('SERVER -> ROOM update text', function (reqRoom, data) {
				if (reqRoom == room || reqRoom == "all") {

					let text = JSON.parse(data)

					updateText(text)
				} else {
					console.log(reqRoom);

				}
			})

			if ($('#sub').val() == "") {
				$('#sub').hide()
			}

			function updateText(data) {

				for (var key in data) {
					// skip loop if the property is from prototype
					if (!data.hasOwnProperty(key)) continue;

					var obj = data[key];
					for (var prop in obj) {
						// skip loop if the property is from prototype
						if (!obj.hasOwnProperty(prop)) continue;

						// your code
						// console.log(prop + " = " + obj[prop]);
						$("[data-name='" + room + "']#" + prop).html(obj[prop])

						if (prop == "width") {
							$('.main_wrapper').css(prop, obj[prop])
							$('#sketchContainer').css(prop, obj[prop])
							resize = true;
						}
					}
				}
			}



			function getTeam(team) {
				$.getJSON('group.json', function (data) {
					var set = data.groups;
					$('#outHead').text(set[team].teamName);
					$('#outSub').text(set[team].members);
					textBg();
				});
			}

			function getTimeTable() {
				$.getJSON('group.json', function (data) {
					$.each(data.groups, function (key, val) {
						var rowId = '#' + key;
						$('#timeBody').append('<tr id=' + key + '>');
						$(rowId)
							.append('<th scope="row">' + val.semester + '</th>')
							.attr('id', key);
						$(rowId).append('<td>' + val.teamName + '</td>');
						$(rowId).append('<td>' + val.members + '</td>');
					});
				});
			}

			getTimeTable();

			function textBg() {
				if ($('#outHead').html() != '') {
					$('#outHead').show();
				} else {
					$('#outHead').hide();
				}

				if ($('#outSub').html() != '') {
					$('#outSub').show();
				} else {
					$('#outSub').hide();
				}
			}
			textBg();

			function countdown(minutes) {
				var seconds = 60;
				var mins = minutes;

				function tick() {
					var current_minutes = mins - 1;
					seconds--;

					//$('#outHead').html(current_minutes.toString() + ":" + (seconds < 10 ? "0" : "") + String(seconds));

					$('#minutes').html(current_minutes.toString());
					$('#seconds').html((seconds < 10 ? '0' : '') + String(seconds));

					if (seconds > 0) {
						time = setTimeout(tick, 1000);
					} else {
						if (mins > 1) {
							countdown(mins - 1);
						}
					}

					if (mins == 1 && seconds < 11) {
						$('.textContainer').hide();
						$('.countdownContainer').hide();
						Countdown.startCountdown();
						clearTimeout(time);
						socket.emit('clear countdown');
					}
					seks = seconds;
					minuten = current_minutes + 1;
				}
				tick();
			}
		});
	</script>
</body>

</html>