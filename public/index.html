<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Interactive Future 2018</title>

  <!-- p5 -->
  <script language="javascript" type="text/javascript" src="p5.js"></script>
  <script language="javascript" src="p5.dom.js"></script>
  <!-- ANIMATIONS -->
  <script language="javascript" src="animation_polys.js"></script>
  <script language="javascript" src="animation_timetable.js"></script>
  <script language="javascript" src="animation_program.js"></script>
  <script language="javascript" src="animation_main.js"></script>
  <!-- css -->
  <title>Document</title>
  <link rel="stylesheet" href="css/bootstrap.min.css">

  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- <h1 class="text">Hello World Public</h1> -->
  <div class="textContainer">
    <h1 class="headline" id="outHead">interactive future</h1>
    <p class="text" id="outSub"></p>
  </div>

  <div class="countdownContainer">
    <div id="minutes"></div>
    <div id="seconds"></div>
  </div>

  <div class="table-content">
    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Semster</th>
          <th scope="col">Gruppe</th>
          <th scope="col">Team</th>
        </tr>
      </thead>
      <tbody id="timeBody">
      </tbody>
    </table>
  </div>

  <script src="socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script>
    var time;
    $(function () {


      var socket = io();
      socket.on('head text', function (msg) {
        clearTimeout(time);
        $('.table-content').hide();
        $('#outHead').text(msg);
        socket.emit('head res', msg)

      });
      socket.on('sub text', function (msg) {
        $('.table-content').hide();
        $('#outSub').text(msg);
        socket.emit('sub res', msg)
      });

      socket.on('func test', function (msg) {
        flyOut(20)
      });

      socket.on('countdown', function (msg) {
        clearTimeout(time);
        countdown(msg)
        socket.emit('countdown res', msg)

      })

      socket.on('team', function (msg) {
        currentAnimation = 0;
        currentTransition = 1;
        setInterval(showTeam(msg), 2)
      })

      function showTeam(msg) {
        $('#outHead').text('');
        $('#outSub').text('');
        $('.table-content').hide()
        getTeam(msg);
      }

      socket.on('timeTable', function () {
        currentAnimation = 4;
        $('#outHead').text('');
        $('#outSub').text('');
        $('.table-content').show();

      })

      function getTeam(team) {
        $.getJSON("group.json", function (data) {
          var set = data.groups
          $('#outHead').text(set[team].teamName);
          $('#outSub').text(set[team].members);
        });
      }

      function getTimeTable() {
        $.getJSON("group.json", function (data) {

          $.each(data.groups, function (key, val) {
            var rowId = '#' + key;
            $('#timeBody').append('<tr id=' + key + '>')
            $(rowId).append('<th scope="row">' + val.semester + '</th>').attr('id', key);
            $(rowId).append('<td>' + val.teamName + '</td>');
            $(rowId).append('<td>' + val.members + '</td>');
          });


        });
      }

      getTimeTable();

      function countdown(minutes) {

        var seconds = 60;
        var mins = minutes

        function tick() {

          var current_minutes = mins - 1
          seconds--;

          //$('#outHead').html(current_minutes.toString() + ":" + (seconds < 10 ? "0" : "") + String(seconds));

          $('#minutes').html(current_minutes.toString())
          $('#seconds').html((seconds < 10 ? "0" : "") + String(seconds))

          if (seconds > 0) {
            time = setTimeout(tick, 1000);
          } else {
            if (mins > 1) {
              countdown(mins - 1);
            }
          }
        }
        tick();
      }
    });
  </script>
</body>

</html>